# Dear Carmate 프론트엔드

## 준비

필요한 패키지를 설치해 주세요.

```bash
npm install
```

## 프로젝트 설정

### API Base URL 환경변수 설정

`.env` 파일 생성 후 `.env.sample` 파일을 참고하여 환경변수를 설정합니다.
예를들어서 로컬 백엔드 서버의 주소가 `http://localhost:3001`이라면 다음과 같이 설정합니다.

```
NEXT_PUBLIC_API_URL=http://localhost:3001
```

이 환경 변수는 Next.js 서버에서 백엔드 서버 주소로 쓸 값입니다. `shared/axios.ts` 파일에서 axios 인스턴스 `baseURL` 설정에 사용됩니다.

## 프로젝트 로컬에서 실행

Next.js 프로젝트를 로컬에서 실행합니다.

```bash
npm run dev
```

## API 수정 및 디버깅 하기

백엔드 부트캠프 과정에서 사용하기 편하도록 `/shared/api.ts`라는 파일에 API 리퀘스트를 보내는 함수만 따로 분리해서 배치해 두었습니다.
이 파일을 수정하여 백엔드 API 리퀘스트를 디버깅하실 수 있습니다.

참고로 이 프로젝트의 코드는 과거 버전의 Next.js (Pages Router)를 기반으로 개발되었는데요, 최신 버전의 Next.js (App Router)와 달리 리퀘스트를 보낼 때 Next.js 서버를 거치지 않고 웹 브라우저에서 백엔드로 바로 보내는 경우가 많습니다.
크롬 개발자 도구 Network 탭에서 보내는 리퀘스트를 관찰하거나, 콘솔 출력을 활용해 보세요.

또한 이 파일에서 엔드포인트 경로를 수정하거나, 원하는 쿼리 파라미터 혹은 바디 타입을 사용하도록 수정하시면 됩니다.

## (참고) 인증 관련 구현
이 프로젝트는 인증을 할 때 다음과 같이 진행되도록 구현되어 있습니다.

### 로그인
사용자가 웹 브라우저에서 이메일과 비밀번호로 인증 요청을 하면,
웹 브라우저는 백엔드에 리퀘스트를 보내 리스폰스 바디로 토큰을 전달 받습니다.
현재 프로젝트에서는 리스폰스 바디로 전달 받은 토큰을 쿠키로 저장하도록 구현되었습니다.

### 인증이 필요한 리퀘스트의 경우
웹 브라우저는 토큰을 쿠키로 저장하고 있습니다.
axios 인스턴스의 인터셉터에서 (`shared/axios.ts` 파일) 만약 토큰을 저장한 쿠키가 있는 경우 이것을 `Authorization: Bearer <access token>` 헤더로 설정합니다.
웹 브라우저 `Authorization` 헤더와 함께 백엔드로 리퀘스트를 보냅니다.

### 액세스 토큰이 만료된 경우
인증이 필요한 요청을 했을 때 401 상태 코드가 오면 axios 인터셉터에서 토큰 갱신을 하도록 구현되어 있습니다.(`shared/axios.ts`) 만약 갱신에 성공하면 리스폰스 바디로 받은 토큰을 쿠키로 저장합니다.


> 참고로 인증을 구현할 수 있는 방식은 여러가지가 있을 수 있으니, 이 방식은 하나의 방식으로 참고만 해 주세요.

### (참고) 이미지 주소 허용

Next.js 프론트엔드에서는 이미지 파일을 사용할 때 `next.config.js` 파일에서 이미지 주소를 허용해 주어야 합니다.
만약 백엔드 서버에 업로드한 이미지 파일이 `http://localhost:3001/.../photo.png`와 같이 제공된다면 Next.js에서 이미지를 올바로 보여주기 위해 해당 주소를 허용해 주어야 합니다. (`remotePatterns` 부분)

현재 코드는 개발 편의를 위해 모든 호스트를 허용하도록 설정되어 있습니다.

```js
module.exports = {
  ...
  images: {
    remotePatterns: [
      {
        hostname: '**',
      },
    ],
  },
}
```